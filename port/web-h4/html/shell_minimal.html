<!doctype html>
<html lang="en-us">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Emscripten-Generated Code</title>
        <style>
            .emscripten {
                padding-right: 0;
                margin-left: auto;
                margin-right: auto;
                display: block;
            }
            textarea.emscripten {
                font-family: monospace;
                width: 80%;
            }
            div.emscripten {
                text-align: center;
            }
            div.emscripten_border {
                border: 1px solid black;
            }
            /* the canvas *must not* have any border or padding, or mouse coords will be wrong */
            canvas.emscripten {
                border: 0px none;
                background-color: black;
            }
        </style>
        <script src="buffered_reader.js"></script>
    </head>
    <body>
        <hr />
        <div class="emscripten">
            <input
                type="button"
                value="Start BTstack..."
                onclick="Module.onStartBTstack()"
            />
        </div>
        <hr />
        <textarea class="emscripten" id="output" rows="8"></textarea>
        <hr />
        <script type="text/javascript">
            var outputElement = document.getElementById("output");
            if (outputElement) outputElement.value = ""; // clear browser cache

            var Module = {
                print(...args) {
                    // These replacements are necessary if you render to raw HTML
                    //text = text.replace(/&/g, "&amp;");
                    //text = text.replace(/</g, "&lt;");
                    //text = text.replace(/>/g, "&gt;");
                    //text = text.replace('\n', '<br>', 'g');
                    console.log(...args);
                    if (outputElement) {
                        var text = args.join(" ");
                        outputElement.value += text + "\n";
                        outputElement.scrollTop = outputElement.scrollHeight; // focus on bottom
                    }
                },
                setStatus(text) {
                    console.log("Set Status: " + text);
                },
                totalDependencies: 0,
                monitorRunDependencies(left) {
                    console.log("monitorRunDependencies: " + left);
                    this.totalDependencies = Math.max(
                        this.totalDependencies,
                        left,
                    );
                    Module.setStatus(
                        left
                            ? "Preparing... (" +
                                  (this.totalDependencies - left) +
                                  "/" +
                                  this.totalDependencies +
                                  ")"
                            : "All downloads complete.",
                    );
                },
            };
            Module.setStatus("Downloading...");
            window.onerror = () => {
                Module.setStatus("Exception thrown, see JavaScript console");
                Module.setStatus = (text) => {
                    if (text) console.error("[post-exception status] " + text);
                };
            };
        </script>
        {{{ SCRIPT }}}
    </body>
</html>
